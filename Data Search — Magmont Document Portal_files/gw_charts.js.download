window.onresize = function(){setMapWindowSize();}

function createRequestObject() {
  var xmlHttp;
  try
  { // Firefox, Opera 8.0+, Safari
   xmlHttp=new XMLHttpRequest();
  }
  catch (e) 
  {
    // Internet Explorer
   try 
   {
    xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
   }
   catch (e)
   {
     try {
         xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
     }
     catch(e) {
         alert("You browser does not support AJAX!"); 
         return false; 
     }
   }
  }
  return xmlHttp;
}


function setMapWindowSize(){
    var NS = getWindowSize();
  if ((NS.height - 210) > 250  )
    {
   document.getElementById('divGraph').style.height = (NS.height -400) + 'px';
   }

    document.getElementById('divGraph').style.width = ((NS.width) - 300) + 'px';
}

function setMapWindowSizeXYZ(){
    var NS = getWindowSize();
  if ((NS.height - 210) > 250  )
    {
   document.getElementById('divGraph').style.height = (NS.height -400) + 'px';
   }

    document.getElementById('divGraph').style.width = (NS.height -400) + 'px';
}


function getWindowSize()
    {
            var e = new Object();
            if(window.self && self.innerWidth)
            {
                e.width = self.innerWidth; 
                e.height = self.innerHeight;
            }
            else if(document.documentElement &&document.documentElement.clientHeight)
            {
                e.width = document.documentElement.clientWidth; 
                e.height = document.documentElement.clientHeight;
            }
            else
            {
                e.width = document.body.clientWidth; 
                e.height = document.body.clientHeight;
           }
            return e
    }        

function _el(a) {
       var b = document.getElementById(a);
       return b;
}


function loadGWGraph() 
{
setMapWindowSize();
var graph_title = 'MW-30 Groundwater Elevation'
//_el('basis').value + " " + _el('analyte').value + " in " + _el('material').value; 
var tmp;
var seriesOpts = []
var seriesOpt = []
var seriesOptList = []

var temp = []
var pointList = []
var jcount = 0;
var icount = 0;
var bExist = false;

var minDate = 1730500000000; 
var maxDate = 0; 
var maxValue = 0; 
var tempList = []; 
var yAxisTitle = 'Groundwater Elevation (feet above mean sea level)';
var graph_sub_title = _el('start_date').value + " to " + _el('end_date').value
var seriesList = []
var seriesList_precip = []
var minDate = 0

$.ajax({
    type:    "GET",
    url:     "http://magmont.exponent.com/data/subMW30Precip_qry?start_date=" + _el('start_date').value + "&end_date=" +_el('end_date').value,
    success: function(text1) {

   $.ajax({
    type:    "GET",
    url:     "http://magmont.exponent.com/data/subMW30GWLevel_qry?start_date=" + _el('start_date').value + "&end_date=" +_el('end_date').value,
    success: function(text) {

    tempList = text.split(';')

    for (i=0; i<tempList.length; i++) {
        pointList = tempList[i].split(','); 
        seriesList[i] = [Number(pointList[0]), Number(pointList[1])];
        pointList = []
     }

    seriesOpts[0] = {type: 'line', name: 'Groundwater Elevation', data: seriesList}
 
    tempList  = []

    tempList = text1.split(';')

    for (i=0; i<tempList.length; i++) {
        pointList = tempList[i].split(','); 
        seriesList_precip[i] = [Number(pointList[0]), Number(pointList[1])];
        pointList = []
     }
    seriesOpts[1] = {type: 'line', name: 'Rainfall (Inches)', yAxis: 1, data: seriesList_precip}

var graph = $("#divGraph")
var chart = graph.highcharts({
        chart: {
            type: 'line',
            zoomType: 'x'
        },
        title: {
            text: graph_title 
        },
        subtitle: {
            text: graph_sub_title
        },
        xAxis: {
            type: 'datetime',
            title: {
                enabled: true,
                text: 'Sample Date'
            },
        },
        yAxis: [{ //first yAxis
            
            title: {
                text: yAxisTitle,                 
            },
            min: 1198, 
            max: 1202

           }, { //secondary yAxis 
            
            title: {
                text: 'Rainfall (inches) - USGS 373955091065901 Bixby'            
             }, 
            opposite: true, 
            min: 0,
            max: 1
           }],
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'top',
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
            borderWidth: 0, 
            y: 30
        },
        plotOptions: {
            line: {
                marker: {
                    enabled: false
                }
            }
        },
        tooltip: {
             shared: true
        },
        series: seriesOpts, 

    });
       },
        error:   function() {
           return;
       }
    });

    },
    error:   function() {
        return;
    }
});
}

function loadGraphTailingX() 
{
setMapWindowSize();

var graph_title = "Tailings Dam Pin Data (X-axis against time)"; 

var seriesOpts = []
var seriesOpt = []
var seriesOptList = []

var temp = []
var pointList = []
var jcount = 0;
var icount = 0;
var bExist = false;

var minDate = 1730500000000; 
var maxDate = 0; 
var maxValue = 0; 
var tempList = []; 
var yAxisTitle = '';

tmp = $.ajax({
    type:    "GET",
    url:     "http://magmont.exponent.com/data/subTailingGraphX_qry",
    success: function(text) {

  pointList = text.split(';')  

  yAxisTitle = "East ----- X-axis (feet)----- West" 

  for(j=0; j < pointList.length ; j++) {
        temp = pointList[j].split(',') 

        if (temp.length  ==2 ) {
            bExist = true;
            if (Number(temp[0]) < minDate) { minDate = Number(temp[0]);} 
            if (Number(temp[0]) > maxDate) { maxDate = Number(temp[0]);} 
            if (Number(temp[1]) > maxValue) { maxValue = Number(temp[1]);} 
            seriesOpt[jcount] = [Number(temp[0]),Number(temp[1])]
            jcount = jcount + 1
        }
        temp = []
  }    
  if (bExist) {
     seriesOpts[icount] = {type: 'scatter', name: 'X-axis (feet)',
            data: seriesOpt} 
     icount = icount + 1
  }

var graph = $("#divGraph")

var chart = graph.highcharts({

        chart: {
            type: 'scatter',
            zoomType: 'xy'
        },
        title: {
            text: graph_title 
        },
        subtitle: {
            text: 'Magmont Mine, Bixby Missouri'
        },
        xAxis: {
            type: 'datetime',
            title: {
                enabled: true,
                text: 'Sample Date'
            },
            showFirstLabel: true,
            showLastLabel: true, 
            min: minDate, 
            max: maxDate
        },
        yAxis: {
            title: {
                text: yAxisTitle
            }
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'top',
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
            borderWidth: 0, 
            y: 30
        },
        plotOptions: {
            scatter: {
                marker: {
                    radius: 5,
                    states: {
                        hover: {
                            enabled: true,
                            lineColor: 'rgb(100,100,100)'
                        }
                    }
                },
                states: {
                    hover: {
                        marker: {
                            enabled: false
                        }
                    }
                },
            }, 
            line: {
                marker: {
                    enabled: true
                }
            }
        },
        tooltip: {
        crosshairs: true,
         formatter: function(){ 
           return '<b>'+ this.series.name +'</b><br/>'+
           Highcharts.dateFormat('%m/%d/%Y', this.x) +', '+ Highcharts.numberFormat(this.y, 2);
         }
      },
        series: seriesOpts, 
    });

    },
    error:   function() {
        return;
    }
});

}

function loadGraphTailingY() 
{
setMapWindowSize();

var graph_title = "Tailings Dam Pin Data (Y-axis against time)"; 

var seriesOpts = []
var seriesOpt = []
var seriesOptList = []

var temp = []
var pointList = []
var jcount = 0;
var icount = 0;
var bExist = false;

var minDate = 1730500000000; 
var maxDate = 0; 
var maxValue = 0; 
var tempList = []; 
var yAxisTitle = '';

tmp = $.ajax({
    type:    "GET",
    url:     "http://magmont.exponent.com/data/subTailingGraphY_qry",
    success: function(text) {

  pointList = text.split(';')  

  yAxisTitle = "South ----- Y-axis (feet)----- North" 

  for(j=0; j < pointList.length ; j++) {
        temp = pointList[j].split(',') 

        if (temp.length  ==2 ) {
            bExist = true;
            if (Number(temp[0]) < minDate) { minDate = Number(temp[0]);} 
            if (Number(temp[0]) > maxDate) { maxDate = Number(temp[0]);} 
            if (Number(temp[1]) > maxValue) { maxValue = Number(temp[1]);} 
            seriesOpt[jcount] = [Number(temp[0]),Number(temp[1])]
            jcount = jcount + 1
        }
        temp = []
  }    
  if (bExist) {
     seriesOpts[icount] = {type: 'scatter', name: 'Y-axis (feet)',
            data: seriesOpt} 
     icount = icount + 1
  }

var graph = $("#divGraph")

var chart = graph.highcharts({

        chart: {
            type: 'scatter',
            zoomType: 'xy'
        },
        title: {
            text: graph_title 
        },
        subtitle: {
            text: 'Magmont Mine, Bixby Missouri'
        },
        xAxis: {
            type: 'datetime',
            title: {
                enabled: true,
                text: 'Sample Date'
            },
            showFirstLabel: true,
            showLastLabel: true, 
            min: minDate, 
            max: maxDate
        },
        yAxis: {
            title: {
                text: yAxisTitle
            }
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'top',
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
            borderWidth: 0, 
            y: 30
        },
        plotOptions: {
            scatter: {
                marker: {
                    radius: 5,
                    states: {
                        hover: {
                            enabled: true,
                            lineColor: 'rgb(100,100,100)'
                        }
                    }
                },
                states: {
                    hover: {
                        marker: {
                            enabled: false
                        }
                    }
                },
            }, 
            line: {
                marker: {
                    enabled: true
                }
            }
        },
        tooltip: {
        crosshairs: true,
         formatter: function(){ 
           return '<b>'+ this.series.name +'</b><br/>'+
           Highcharts.dateFormat('%m/%d/%Y', this.x) +', '+ Highcharts.numberFormat(this.y, 2);
         }
      },
        series: seriesOpts, 
    });

    },
    error:   function() {
        return;
    }
});

}

function loadGraphTailingZ() 
{
setMapWindowSize();

var graph_title = "Tailings Dam Pin Data (elevations against time)"; 

var seriesOpts = []
var seriesOpt = []
var seriesOptList = []

var temp = []
var pointList = []
var jcount = 0;
var icount = 0;
var bExist = false;

var minDate = 1730500000000; 
var maxDate = 0; 
var maxValue = 0; 
var tempList = []; 
var yAxisTitle = '';

tmp = $.ajax({
    type:    "GET",
    url:     "http://magmont.exponent.com/data/subTailingGraphZ_qry",
    success: function(text) {

  pointList = text.split(';')  

  yAxisTitle = "Elevations (feet)" 

  for(j=0; j < pointList.length ; j++) {
        temp = pointList[j].split(',') 

        if (temp.length  ==2 ) {
            bExist = true;
            if (Number(temp[0]) < minDate) { minDate = Number(temp[0]);} 
            if (Number(temp[0]) > maxDate) { maxDate = Number(temp[0]);} 
            if (Number(temp[1]) > maxValue) { maxValue = Number(temp[1]);} 
            seriesOpt[jcount] = [Number(temp[0]),Number(temp[1])]
            jcount = jcount + 1
        }
        temp = []
  }    
  if (bExist) {
     seriesOpts[icount] = {type: 'scatter', name: 'Elevations (feet)',
            data: seriesOpt} 
     icount = icount + 1
  }

var graph = $("#divGraph")

var chart = graph.highcharts({

        chart: {
            type: 'scatter',
            zoomType: 'xy'
        },
        title: {
            text: graph_title 
        },
        subtitle: {
            text: 'Magmont Mine, Bixby Missouri'
        },
        xAxis: {
            type: 'datetime',
            title: {
                enabled: true,
                text: 'Sample Date'
            },
            showFirstLabel: true,
            showLastLabel: true, 
            min: minDate, 
            max: maxDate
        },
        yAxis: {
            title: {
                text: yAxisTitle
            }
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'top',
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
            borderWidth: 0, 
            y: 30
        },
        plotOptions: {
            scatter: {
                marker: {
                    radius: 5,
                    states: {
                        hover: {
                            enabled: true,
                            lineColor: 'rgb(100,100,100)'
                        }
                    }
                },
                states: {
                    hover: {
                        marker: {
                            enabled: false
                        }
                    }
                },
            }, 
            line: {
                marker: {
                    enabled: true
                }
            }
        },
        tooltip: {
        crosshairs: true,
         formatter: function(){ 
           return '<b>'+ this.series.name +'</b><br/>'+
           Highcharts.dateFormat('%m/%d/%Y', this.x) +', '+ Highcharts.numberFormat(this.y, 2);
         }
      },
        series: seriesOpts, 
    });

    },
    error:   function() {
        return;
    }
});

}

function loadGraphTailingXYZ() 
{
setMapWindowSizeXYZ();

var graph_title = "Tailings Dam Pin Data"; 
var graph; 
var chart1;

var seriesOpts = [];
var seriesOpt = [];
var seriesTmp = {};

var temp = [];
var pointList = [];
var jcount = 0;
var icount = 0;
var bExist = false;

tmp = $.ajax({
    type:    "GET",
    url:     "http://magmont.exponent.com/data/subTailingGraphXYZ_qry",
    success: function(text) {

    pointList = text.split(';')  
  
    for(j=0; j < pointList.length ; j++) {
        temp = pointList[j].split(',') 
        if (temp.length  ==  4) {
           seriesOpt[0] = [Number(temp[0]),Number(temp[2]), Number(temp[1])]; 
           
           seriesOpts[jcount] = {name: temp[3], data: seriesOpt} 


           jcount = jcount + 1
        }
        seriesOpt =[]
        temp = []
    }    



    var chart = new Highcharts.Chart({
        chart: {
             renderTo: 'divGraph',			
	     margin: 100,
             type: 'scatter',
	     options3d: {
                enabled: true,
                alpha: 10,
                beta: 30,
                depth: 250,
                viewDistance: 5,
                fitToPlot: false,
                frame: {
                    bottom: { size: 1, color: 'rgba(0,0,0,0.02)' },
                    back: { size: 1, color: 'rgba(0,0,0,0.04)' },
                    side: { size: 1, color: 'rgba(0,0,0,0.06)' }
                }
            }            
        },
        title: {
            text: graph_title 
        },
        subtitle: {
            text: 'Click and drag the plot area to rotate in space'
        },
        yAxis: {
            title: null
        },
        xAxis: {
            gridLineWidth: 1
        },
        zAxis: {
            showFirstLabel: false
        },
        legend: {
            enabled: false
        },
        series: seriesOpts, 
      });


    // Add mouse events for rotation
    $("#divGraph").bind('mousedown.hc touchstart.hc', function (eStart) {

         eStart = chart.pointer.normalize(eStart);

         var posX = eStart.pageX,
            posY = eStart.pageY,
            alpha = chart.options.chart.options3d.alpha,
            beta = chart.options.chart.options3d.beta,
            newAlpha,
            newBeta,
            sensitivity = 5; // lower is more sensitive
        $(document).bind({
            'mousemove.hc touchdrag.hc': function (e) {
                // Run beta
                newBeta = beta + (posX - e.pageX) / sensitivity;
                chart.options.chart.options3d.beta = newBeta;

                // Run alpha
                newAlpha = alpha + (e.pageY - posY) / sensitivity;
                chart.options.chart.options3d.alpha = newAlpha;

                chart.redraw(false);
            },
            'mouseup touchend': function () {
                $(document).unbind('.hc');
            }
        });

    });
    //end of mouse bind


    },
    error:   function() {
        return;
    }

  });


}


